name: Dart CI

on: 
  push:
    branches:    
      - master 

jobs:
  jobLinux:
    name: Build APK
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v1
    - uses: actions/setup-java@v1
      with:
        java-version: '12.x'
    - uses: subosito/flutter-action@v1
    - run: flutter pub get
    - run: flutter test
    #- run: flutter build apk
    #- name: Create a Release APK
    #  uses: ncipollo/release-action@v1
    #  with:
    #    artifacts: "build/app/outputs/apk/release/Cogboard_mobile_${{github.job}}.apk"
    #    tag: ${{github.job}}
    #    token: ${{ secrets.TOKEN }}
  jobmacOS:
    name: Build IPA
    runs-on: [macos-latest]
    env:
      XC_VERSION: ${{ '11.4' }}
      XC_WORKSPACE: ${{ 'MyApp.xcworkspace' }}
      XC_SCHEME: ${{ 'MyApp' }}
    steps:
    - name: Select latest Xcode
      run: "sudo xcode-select -s /Applications/Xcode_$XC_VERSION.app"
    - uses: actions/checkout@v2
    - name: Run Unit and UI Tests
      run: /usr/bin/xcodebuild test -workspace "$XC_WORKSPACE" -scheme "$XC_SCHEME" -destination 'platform=iOS Simulator,name=iPhone 11'
    - run: flutter build ios --release --no-codesign
    - name: Create a Release iOS files
      uses: ncipollo/release-action@v1
      with:
        artifacts: "build/app/outputs/ios/release/Cogboard_mobile_${{github.job}}.ipa"
        tag: ${{github.job}}
        token: ${{ secrets.TOKEN }}
